<div class="card card-default">
  <div class="card-header">
    <div class="d-flex w-100 justify-content-between">
      <h5>{{section.title}}</h5>

      <ng-template #modalContent let-c="close" let-d="dismiss">
          <div class="modal-header">
            <h4>{{section.code.coding[0].display}}</h4>

            <span *ngIf="isSNOMED(section.code.coding[0].system)">
        <a (click)="getSNOMEDLink(section.code.coding[0])">
             <span *ngIf="section.code.coding[0].code != undefined" class="fa fa-book" ngbTooltip="{{getCodeSystem(section.code.coding[0].system)}} {{section.code.coding[0].code}}"></span>
        </a></span>


            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

           <div class="modal-body">

                <div class="row">
                <div class="col-lg-7">
                <div *ngIf="section.entry != undefined">
                  References {{section.entry.length}} entries

                  <br><br>
                  <table >
                    <div *ngFor="let ent of entries" >
                      <tr>
                        <td>{{ent.resource}}</td>
                        <td *ngIf="ent.code!=undefined" [ngSwitch]="ent.resource">
                          <span *ngIf="isSNOMED(ent.code)">
                            <span *ngSwitchCase="'Medication'"><a href="{{getDMDLink(ent.code)}}" target="_blank">dm+d</a> <a href="{{getSNOMEDLink(ent.code)}}" target="_blank">SCT</a></span>
                            <span *ngSwitchCase="'MedicationRequest'"><a href="{{getDMDLink(ent.code)}}" target="_blank">dm+d</a> <a href="{{getSNOMEDLink(ent.code)}}" target="_blank">SCT</a></span>
                            <span *ngSwitchDefault><a href="{{getSNOMEDLink(ent.code)}}" target="_blank">SCT</a></span>
                          </span>
                          <span *ngIf="!isSNOMED(ent.code)">
                            code=<i>{{ent.code}}</i>
                          </span>
                        </td>
                        <td *ngIf="ent.code==undefined"></td>
                        <td *ngIf="ent.display!=undefined">
                         {{ent.display}}</td>
                        <td *ngIf="ent.display==undefined">
                        </td>
                      </tr>
                    </div>
                 </table>

                  <span *ngIf="allergies.length>0">
                      <h4>Allergies</h4>
                      <app-allergy-intollerance [allergies]="allergies" (allergy)="onResoureSelected($event)"></app-allergy-intollerance>
                  </span>
                  <span *ngIf="patients.length>0">
                      <h4>Patient</h4>
                      <app-patient [patients]="patients" (patient)="onResoureSelected($event)"></app-patient>
                  </span>
                  <span *ngIf="practitioners.length>0">
                      <h4>Practitioner</h4>
                      <app-practitioner-list [practitioners]="practitioners" (practitioner)="onResoureSelected($event)"></app-practitioner-list>
                  </span>
                  <span *ngIf="organisations.length>0">
                      <h4>Organisation</h4>
                      <app-organisation-list [organisations]="organisations" (organisation)="onResoureSelected($event)"></app-organisation-list>
                  </span>
                  <span *ngIf="observations.length>0">
                      <h4>Observations</h4>
                      <app-observation [observations]="observations" (observation)="onResoureSelected($event)"></app-observation>
                  </span>
                  <span *ngIf="encounters.length>0">
                      <h4>Encounter</h4>
                      <app-encounter [encounters]="encounters" (encounter)="onResoureSelected($event)"></app-encounter>
                  </span>
                  <span *ngIf="medicationStatements.length>0">
                      <h4>Medication Statement</h4>
                      <app-medication-statement [medicationStatements]="medicationStatements" [meds]="medications" (medicationStatement)="onResoureSelected($event)"></app-medication-statement>
                  </span>
                  <span *ngIf="conditions.length>0">
                      <h4>Conditions</h4>
                      <app-condition [conditions]="conditions" (condition)="onResoureSelected($event)"></app-condition>
                  </span>
                  <span *ngIf="procedures.length>0">
                      <h4>Procedure</h4>
                      <app-procedure [procedures]="procedures" (procedure)="onResoureSelected($event)"></app-procedure>
                  </span>
                  <span *ngIf="medications.length > 0">
                      <h4>Medications</h4>
                      <app-medication [medications]="medications" (medication)="onResoureSelected($event)"></app-medication>
                  </span>
                  <span *ngIf="prescriptions.length>0">
                      <h4>Prescriptions</h4>
                      <app-medication-request [medicationRequests]="prescriptions" [meds]="medications" (medicationRequest)="onResoureSelected($event)"></app-medication-request>
                  </span>
                </div>
                <div *ngIf="section.entry == undefined">
                  No structured content referenced
                </div>
                 </div>
                 <div class="col-lg-5">
                   <app-resource-viewer></app-resource-viewer>
                 </div>
              </div>
           </div>

        </ng-template>

      <button *ngIf="section.entry != undefined" class="btn-info"  placement="top" (click)="open(modalContent)">
        View Structured Content</button>
      <button *ngIf="section.entry == undefined" disabled="true" class="btn-outline-info"  placement="top" (click)="open(modalContent)">
        No Structured Content</button>
    </div>
  </div>
  <div class="card-body" >
    <div [innerHTML]="section.text.div"></div>
  </div>
</div>
